<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bestride Carolinas — Book a Ride</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 18px; max-width: 820px; margin: auto; }
    h1 { margin-bottom: 8px; }
    label { display:block; margin-top:10px; font-weight:600; }
    input, button, textarea { width:100%; padding:8px; margin-top:6px; box-sizing:border-box; }
    #map { width:100%; height:300px; margin-top:12px; border:1px solid #ddd; }
    .row { display:flex; gap:10px; }
    .row > * { flex:1; }
    .small { width:48%; }
    .message { margin-top:12px; padding:10px; border-radius:6px; display:none; }
    .message.success { background:#e6ffed; border:1px solid #b7f0c6; color:#065a21; }
    .message.error { background:#ffecec; border:1px solid #f5b4b4; color:#7a1a1a; }
  </style>
</head>
<body>
  <h1>Bestride Carolinas</h1>
  <p>Book your ride. We will confirm by SMS.</p>

  <form id="bookingForm">
    <label for="name">Name</label>
    <input id="name" name="name" placeholder="Your full name" required>

    <label for="pickup">Pickup location</label>
    <input id="pickup" name="pickup" placeholder="e.g. 123 Main St, Charlotte" required>

    <label for="dropoff">Drop-off location</label>
    <input id="dropoff" name="dropoff" placeholder="e.g. CLT Airport" required>

    <label for="phone">Phone number</label>
    <input id="phone" name="phone" placeholder="+1XXXXXXXXXX" required>

    <div class="row">
      <div>
        <label for="date">Date</label>
        <input id="date" name="date" type="date" required>
      </div>
      <div>
        <label for="time">Time</label>
        <input id="time" name="time" type="time" required>
      </div>
    </div>

    <button type="submit" style="margin-top:12px;">Book Ride</button>
  </form>

  <div id="map"></div>

  <div id="success" class="message success">Booking created — check your phone for SMS confirmation.</div>
  <div id="error" class="message error">Oops! Something went wrong. See console for details.</div>

<script>
  // Map + Autocomplete
  let map, marker, pickupAutocomplete, dropoffAutocomplete;
  function initMap() {
    const defaultPos = { lat: 35.2271, lng: -80.8431 }; // Charlotte
    map = new google.maps.Map(document.getElementById("map"), {
      center: defaultPos,
      zoom: 12
    });
    marker = new google.maps.Marker({ map, position: defaultPos });

    const pickupInput = document.getElementById("pickup");
    const dropoffInput = document.getElementById("dropoff");
    pickupAutocomplete = new google.maps.places.Autocomplete(pickupInput);
    dropoffAutocomplete = new google.maps.places.Autocomplete(dropoffInput);

    pickupAutocomplete.addListener("place_changed", () => updateMapFromAutocomplete(pickupAutocomplete));
    dropoffAutocomplete.addListener("place_changed", () => updateMapFromAutocomplete(dropoffAutocomplete));
  }

  function updateMapFromAutocomplete(autocomplete) {
    const place = autocomplete.getPlace();
    if (!place.geometry) return;
    map.setCenter(place.geometry.location);
    map.setZoom(15);
    marker.setPosition(place.geometry.location);
  }

  // Submit booking to backend
  document.getElementById("bookingForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    hideMessages();
    const payload = {
      name: document.getElementById("name").value.trim(),
      pickup: document.getElementById("pickup").value.trim(),
      dropoff: document.getElementById("dropoff").value.trim(),
      phone: document.getElementById("phone").value.trim(),
      date: document.getElementById("date").value,
      time: document.getElementById("time").value
    };

    try {
      const res = await fetch('/bookings', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      if (!res.ok) throw new Error('Server responded ' + res.status);
      showSuccess();
      document.getElementById("bookingForm").reset();
    } catch (err) {
      console.error('Booking error:', err);
      showError();
    }
  });

  function showSuccess(){ const d=document.getElementById("success"); d.style.display='block'; }
  function showError(){ const d=document.getElementById("error"); d.style.display='block'; }
  function hideMessages(){ document.getElementById("success").style.display='none'; document.getElementById("error").style.display='none'; }
</script>

<!-- ********** IMPORTANT **********
 Replace YOUR_GOOGLE_MAPS_API_KEY with your actual API key below.
-->
<script
  src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&libraries=places&callback=initMap"
  async defer>
</script>
</body>
</html>

